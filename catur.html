<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TINO</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlc2z/cCz/Rk+t4A4/qf/sR+7w5U/W3X6t3b2L6U7D0M2kP+YnBv7M2N/p2z/d6+7V1A8A3O4P5w4E9T/w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        /* Impor Google Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@400;600;700&family=Open+Sans:wght@300;400;600&display=swap');

        /* Variabel Warna Global (Palet Premium yang Diperkaya) */
        :root {
            --bg-deep-dark: #0f0f0f; /* Latar belakang paling gelap */
            --bg-dark-card: #1c1c1c; /* Latar belakang kartu utama */
            --bg-lighter-card: #282828; /* Latar belakang item/row yang lebih terang */
            --border-primary: #333; /* Garis pemisah yang jelas */
            --accent-gold: #D4AF37; /* Emas yang mewah */
            --accent-silver: #A0A0A0; /* Perak yang elegan */
            --accent-red-dominant: #C62828; /* Merah marun yang kuat */
            --text-high-contrast: #F5F5F5; /* Teks paling terang */
            --text-medium-contrast: #B0B0B0; /* Teks detail/sekunder */
            --text-low-contrast: #707070; /* Teks caption yang sangat halus */
            --win-color: #2e7d32; /* Hijau tua yang elegan */
            --lose-color: #d32f2f; /* Merah tua yang solid */
            --draw-color: #ffa000; /* Oranye/emas yang lebih gelap */
            --hover-light: rgba(255, 255, 255, 0.04); /* Efek hover sangat halus */
            --active-light: rgba(255, 255, 255, 0.08); /* Efek active lebih jelas */
        }

        /* --- Global Resets & Body Styling --- */
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html {
            scroll-behavior: smooth; /* Animasi scroll halus */
        }

        body {
            font-family: 'Open Sans', sans-serif; /* Font utama untuk keterbacaan */
            background: var(--bg-deep-dark);
            color: var(--text-medium-contrast);
            line-height: 1.7; /* Line height lebih nyaman */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            /* Gradien latar belakang yang lebih kompleks dan halus */
            background: linear-gradient(135deg, var(--bg-deep-dark) 0%, #1a1a1a 50%, var(--bg-deep-dark) 100%);
            background-size: 200% 200%; /* Untuk animasi gradien */
            animation: gradientBG 15s ease infinite; /* Animasi gradien lambat */
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- Header Styling --- */
        header {
            background: linear-gradient(to right, #1a1a1a, #2a2a2a); /* Gradien pada header */
            padding: 40px 30px; /* Padding lebih besar */
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.7); /* Bayangan lebih kuat */
            border-bottom: 6px solid var(--accent-gold); /* Garis emas yang lebih tebal */
            position: relative;
            overflow: hidden; /* Untuk efek overlay */
        }

        header::before { /* Overlay semi-transparan */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.2); /* Sedikit overlay gelap */
            z-index: 0;
        }

        header h1 {
            margin: 0;
            color: var(--accent-gold);
            font-family: 'Playfair Display', serif;
            font-size: 4.2em; /* Ukuran judul lebih besar */
            letter-spacing: 4px; /* Spacing lebih luas */
            text-shadow: 4px 4px 10px rgba(0, 0, 0, 0.9); /* Bayangan teks lebih kuat */
            text-transform: uppercase;
            position: relative; z-index: 1;
        }
        header p {
            color: var(--text-medium-contrast);
            font-family: 'Montserrat', sans-serif; /* Font Montserrat untuk sub-judul */
            font-size: 1.4em; /* Ukuran sub-judul lebih besar */
            margin-top: 15px;
            letter-spacing: 1px;
            font-weight: 400;
            position: relative; z-index: 1;
        }

        /* --- Main Container --- */
        .container {
            max-width: 1400px; /* Lebar maksimum lebih besar */
            margin: 50px auto; /* Margin atas/bawah lebih besar */
            padding: 0 40px; /* Padding samping lebih besar */
            flex-grow: 1;
            display: flex; /* Menggunakan flexbox untuk layout di masa depan */
            flex-direction: column;
            gap: 40px; /* Jarak antar kartu */
        }

        /* --- Section Cards (Panel) --- */
        .section-card {
            background: var(--bg-dark-card);
            border-radius: 20px; /* Corner lebih membulat */
            padding: 45px; /* Padding lebih besar */
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.8); /* Bayangan sangat kuat */
            border: 1px solid var(--border-primary);
            transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94), box-shadow 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Transisi lebih halus */
            position: relative;
            overflow: hidden;
        }
        .section-card::before { /* Border gradien internal */
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 20px;
            padding: 2px; /* Tebal border semu */
            background: linear-gradient(45deg, var(--accent-gold), var(--accent-red-dominant));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 0;
        }

        .section-card:hover {
            transform: translateY(-8px); /* Efek 'angkat' lebih dramatis */
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.9); /* Bayangan lebih intens */
        }

        .section-card h2 {
            color: var(--text-high-contrast);
            text-align: center;
            margin-top: 0;
            margin-bottom: 40px; /* Margin lebih besar */
            font-size: 3em; /* Ukuran judul bagian lebih besar */
            font-family: 'Playfair Display', serif;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative; z-index: 1;
            /* Garis bawah dengan efek gradien */
            padding-bottom: 20px;
            border-image: linear-gradient(to right, transparent, var(--accent-gold) 20%, var(--accent-red-dominant) 80%, transparent) 1;
            border-image-slice: 1;
            border-bottom: 2px solid;
        }
        .section-card h2 i { /* Styling untuk ikon di judul */
            margin-right: 15px;
            color: var(--accent-gold);
        }

        /* --- Klasemen Table Styles --- */
        .standings-table {
            width: 100%;
            border-collapse: separate; /* Penting untuk border-radius pada sel */
            border-spacing: 0; /* Menghilangkan jarak antar sel */
            margin-top: 30px;
            overflow: hidden; /* Untuk memastikan border-radius bekerja */
            border-radius: 15px;
        }

        .standings-table th, .standings-table td {
            padding: 20px 30px; /* Padding lebih besar */
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06); /* Garis pemisah sangat halus */
            border-right: 1px solid rgba(255, 255, 255, 0.03); /* Garis vertikal halus */
        }
        .standings-table th:last-child,
        .standings-table td:last-child {
            border-right: none; /* Hilangkan garis kanan pada kolom terakhir */
        }
        .standings-table tbody tr:last-child td {
            border-bottom: none; /* Hilangkan garis bawah pada baris terakhir */
        }


        .standings-table th {
            background-color: var(--bg-lighter-card); /* Latar belakang header tabel */
            color: var(--accent-silver);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 1.1em;
            letter-spacing: 0.7px;
            position: sticky;
            top: 0;
            z-index: 2; /* Pastikan di atas baris */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3); /* Bayangan halus di bawah header */
        }

        .standings-table tbody tr {
            background-color: var(--bg-dark-card);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .standings-table tbody tr:nth-child(even) {
            background-color: var(--bg-lighter-card); /* Warna selang-seling */
        }

        .standings-table tbody tr:hover {
            background-color: var(--hover-light); /* Efek hover yang lebih elegan */
            transform: scale(1.01); /* Sedikit membesar saat hover */
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1; /* Pastikan di atas sel lain saat di-hover */
            position: relative;
        }

        .standings-table td.rank {
            font-weight: 700;
            color: var(--accent-gold);
            font-size: 1.2em;
        }

        .standings-table td.player-name {
            font-weight: 600;
            color: var(--text-high-contrast);
            cursor: pointer;
            text-decoration: none;
            transition: color 0.2s ease, text-decoration 0.2s ease;
        }
        .standings-table td.player-name:hover {
            text-decoration: underline;
            color: var(--accent-gold);
        }

        .standings-table td.country {
            color: var(--text-low-contrast);
            font-size: 0.95em;
        }

        .standings-table td.points,
        .standings-table td.tb-value {
            font-weight: 700;
            color: var(--win-color);
            font-size: 1.2em;
        }
        .standings-table td.tb-value {
            font-size: 1.05em;
            color: var(--text-medium-contrast);
        }

        /* --- Player Details Styles --- */
        #player-detail-view h2 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        #player-detail-view h2 .player-score {
            font-size: 0.9em;
            background: linear-gradient(to right, var(--accent-gold), #FFD700); /* Gradien pada skor */
            padding: 10px 20px;
            border-radius: 12px;
            color: var(--bg-deep-dark);
            margin-left: 25px;
            min-width: 120px;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.5);
            text-transform: uppercase;
        }

        .match-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); /* Kolom lebih lebar */
            gap: 30px; /* Jarak antar match item */
            margin-top: 35px;
        }

        .match-item {
            background: var(--bg-lighter-card);
            padding: 25px 30px;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border-primary);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .match-item:hover {
            background-color: var(--hover-light);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
        }

        .match-round {
            font-size: 0.95em;
            color: var(--accent-silver);
            font-weight: 600;
            text-transform: uppercase;
            border-bottom: 1px dashed rgba(255, 255, 255, 0.15);
            padding-bottom: 10px;
            margin-bottom: 8px;
        }
        .match-round i { /* Ikon di babak */
            margin-right: 8px;
            color: var(--accent-red-dominant);
        }

        .match-players {
            font-size: 1.3em; /* Ukuran nama pemain lebih besar */
            font-weight: 600;
            color: var(--text-high-contrast);
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }
        .match-players strong {
            color: var(--accent-gold);
            font-family: 'Montserrat', sans-serif;
            margin-right: 5px;
        }
        .match-players span.color-label {
            font-size: 0.7em;
            color: var(--text-medium-contrast);
            margin-left: 5px;
            font-weight: normal;
        }

        .match-result {
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 1.05em;
            text-align: center;
            align-self: flex-start;
            margin-top: 15px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .win {
            background-color: var(--win-color);
            color: #fff;
        }

        .lose {
            background-color: var(--lose-color);
            color: #fff;
        }

        .draw {
            background-color: var(--draw-color);
            color: var(--bg-deep-dark); /* Teks gelap di background cerah */
        }

        /* --- Navigation Buttons --- */
        .nav-btn-container {
            text-align: center;
            margin-top: 50px; /* Margin lebih besar */
        }

        .nav-btn {
            padding: 18px 35px; /* Padding lebih besar */
            font-weight: 700; /* Lebih tebal */
            border-radius: 12px; /* Lebih membulat */
            border: none;
            cursor: pointer;
            background: linear-gradient(45deg, var(--accent-gold), #FFD700); /* Gradien pada tombol */
            color: var(--bg-deep-dark);
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            font-size: 1.3em; /* Ukuran tombol lebih besar */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.5);
            font-family: 'Montserrat', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .nav-btn:hover {
            background: linear-gradient(45deg, #FFD700, var(--accent-gold)); /* Balik gradien saat hover */
            transform: translateY(-5px); /* Efek 'angkat' lebih kuat */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.7);
        }

        .nav-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.4);
        }


        /* --- Responsive Adjustments --- */
        @media (max-width: 1200px) {
            .container {
                max-width: 100%;
                padding: 0 30px;
            }
            .section-card {
                padding: 35px;
            }
            .section-card h2 {
                font-size: 2.8em;
            }
            .standings-table th, .standings-table td {
                padding: 18px 25px;
            }
        }

        @media (max-width: 992px) {
            header h1 {
                font-size: 3.5em;
            }
            header p {
                font-size: 1.2em;
            }
            .section-card h2 {
                font-size: 2.5em;
                margin-bottom: 30px;
            }
            .standings-table th, .standings-table td {
                padding: 15px 20px;
                font-size: 0.95em;
            }
            .standings-table td.points, .standings-table td.tb-value {
                font-size: 1.1em;
            }
            .match-list {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 25px;
            }
            .match-item {
                padding: 20px 25px;
            }
            .match-players {
                font-size: 1.2em;
            }
            .nav-btn {
                padding: 15px 30px;
                font-size: 1.2em;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 30px 20px;
            }
            header h1 {
                font-size: 2.8em;
                letter-spacing: 2px;
            }
            header p {
                font-size: 1em;
            }
            .container {
                margin: 30px auto;
                padding: 0 20px;
                gap: 30px;
            }
            .section-card {
                padding: 30px;
                border-radius: 18px;
            }
            .section-card h2 {
                font-size: 2.2em;
                margin-bottom: 25px;
                padding-bottom: 15px;
            }
            /* Table stacking for small screens */
            .standings-table thead {
                display: none;
            }
            .standings-table, .standings-table tbody, .standings-table tr, .standings-table td {
                display: block;
                width: 100%;
            }
            .standings-table tr {
                margin-bottom: 20px;
                border: 1px solid var(--border-primary);
                border-radius: 15px;
                background-color: var(--bg-lighter-card);
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
                overflow: hidden;
            }
            .standings-table td {
                text-align: right;
                padding-left: 55%; /* Ruang untuk label */
                position: relative;
                font-size: 1em;
                border: none; /* Hilangkan border internal */
                border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
            }
            .standings-table td:last-child {
                border-bottom: none;
            }
            .standings-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 20px;
                width: calc(55% - 40px);
                padding-right: 20px;
                white-space: nowrap;
                text-align: left;
                font-weight: 600;
                color: var(--accent-silver);
            }
            .standings-table td.rank::before { content: "Peringkat:"; }
            .standings-table td.player-name::before { content: "Pemain:"; }
            .standings-table td.country::before { content: "Negara:"; }
            .standings-table td.points::before { content: "Poin:"; }
            .standings-table td.tb-value[data-label="TB1:"]::before { content: "TB1 (BC1):"; }
            .standings-table td.tb-value[data-label="TB2:"]::before { content: "TB2 (SB):"; }
            .standings-table td.tb-value[data-label="TB3:"]::before { content: "TB3 (Prog):"; }

            #player-detail-view h2 .player-score {
                margin-left: 0;
                margin-top: 15px;
                font-size: 0.85em;
                padding: 8px 15px;
            }
            .match-list {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .match-item {
                padding: 20px;
                border-radius: 12px;
            }
            .match-players {
                font-size: 1.1em;
            }
            .match-result {
                padding: 8px 15px;
                font-size: 1em;
            }
            .nav-btn {
                padding: 12px 25px;
                font-size: 1.1em;
            }
        }

        @media (max-width: 480px) {
            header {
                padding: 25px 15px;
            }
            header h1 {
                font-size: 2.2em;
            }
            header p {
                font-size: 0.9em;
            }
            .container {
                padding: 0 15px;
            }
            .section-card {
                padding: 25px;
            }
            .section-card h2 {
                font-size: 1.8em;
            }
            .standings-table td {
                padding-left: 50%;
            }
            .standings-table td::before {
                width: calc(50% - 30px);
            }
            .match-round {
                font-size: 0.9em;
            }
            .match-players {
                font-size: 1em;
            }
        }
    </style>
</head>
<body>

    <header>
        <h1>Kejuaraan Catur Dunia Grand Master</h1>
        <p>Turnamen Bergengsi Musim 2024</p>
    </header>

    <div class="container">
        <div class="section-card" id="standings-view">
            <h2><i class="fas fa-trophy"></i> Klasemen Akhir</h2>
            <div id="standings-container">
                </div>
        </div>

        <div class="section-card" id="player-detail-view" style="display: none;">
            <h2 id="player-detail-name"></h2>
            <div id="player-matches-container" class="match-list">
                </div>
            <div class="nav-btn-container">
                <button class="nav-btn" id="back-to-standings-btn" aria-label="Kembali ke Klasemen"><i class="fas fa-arrow-left"></i> Kembali ke Klasemen</button>
            </div>
        </div>
    </div>

    <script>
        // --- Data Pemain dan Hasil Pertandingan untuk 5 Babak ---
        // ID pemain harus unik dan konsisten untuk pairing.
        // Format hasil: "1-0" (Putih menang), "0-1" (Hitam menang), "1/2-1/2" (Seri)
        const players = [
            { id: "carlsen", name: "Magnus Carlsen", country: "NOR" },
            { id: "firouzja", name: "Alireza Firouzja", country: "FRA" },
            { id: "caruana", name: "Fabiano Caruana", country: "USA" },
            { id: "nepomniachtchi", name: "Ian Nepomniachtchi", country: "RUS" },
            { id: "nakamura", name: "Hikaru Nakamura", country: "USA" },
            { id: "dingliren", name: "Ding Liren", country: "CHN" }
        ];

        // Simulasi Pairing dan Hasil (5 Babak)
        // Pastikan setiap pemain memiliki lawan di setiap babak dan hasilnya konsisten
        const matches = [
            // Babak 1
            { round: 1, white: "carlsen", black: "firouzja", result: "1-0" },
            { round: 1, white: "caruana", black: "nepomniachtchi", result: "1-0" },
            { round: 1, white: "nakamura", black: "dingliren", result: "1-0" },

            // Babak 2
            { round: 2, white: "firouzja", black: "dingliren", result: "1-0" }, // Firouzja vs Ding
            { round: 2, white: "nepomniachtchi", black: "nakamura", result: "0-1" }, // Nepo vs Nakamura
            { round: 2, white: "carlsen", black: "caruana", result: "1/2-1/2" }, // Carlsen vs Caruana

            // Babak 3
            { round: 3, white: "caruana", black: "dingliren", result: "1-0" },
            { round: 3, white: "nakamura", black: "firouzja", result: "1/2-1/2" },
            { round: 3, white: "carlsen", black: "nepomniachtchi", result: "1-0" },

            // Babak 4
            { round: 4, white: "dingliren", black: "nepomniachtchi", result: "0-1" }, // Ding vs Nepo
            { round: 4, white: "firouzja", black: "caruana", result: "1-0" }, // Firouzja vs Caruana
            { round: 4, white: "nakamura", black: "carlsen", result: "1/2-1/2" }, // Nakamura vs Carlsen

            // Babak 5
            { round: 5, white: "carlsen", black: "dingliren", result: "1-0" },
            { round: 5, white: "nepomniachtchi", black: "firouzja", result: "0-1" }, // Nepo vs Firouzja
            { round: 5, white: "caruana", black: "nakamura", result: "1/2-1/2" }
        ];

        // --- Helper Functions (Sama persis seperti sebelumnya) ---

        function getPointsFromResult(resultString, playerColor) {
            if (resultString === "1-0") { return playerColor === "white" ? 1 : 0; }
            else if (resultString === "0-1") { return playerColor === "black" ? 1 : 0; }
            else if (resultString === "1/2-1/2") { return 0.5; }
            return 0;
        }

        function getPlayerById(playerId) {
            return players.find(p => p.id === playerId);
        }

        function getRelativeResult(currentPlayerId, match) {
            if (match.white === currentPlayerId) {
                if (match.result === "1-0") return "win";
                if (match.result === "0-1") return "lose";
                if (match.result === "1/2-1/2") return "draw";
            } else if (match.black === currentPlayerId) {
                if (match.result === "1-0") return "lose";
                if (match.result === "0-1") return "win";
                if (match.result === "1/2-1/2") return "draw";
            }
            return "N/A";
        }

        function getResultTextAndClass(result) {
            switch (result) {
                case "win": return { text: "Menang", class: "win" };
                case "lose": return { text: "Kalah", class: "lose" };
                case "draw": return { text: "Seri", class: "draw" };
                default: return { text: "N/A", class: "" };
            }
        }

        function calculateAllMetrics() {
            const playerStats = players.map(player => ({
                ...player,
                points: 0,
                opponents: [],
                progressiveScores: Array(5).fill(0)
            }));

            const sortedMatches = [...matches].sort((a, b) => a.round - b.round);

            sortedMatches.forEach(match => {
                const whitePlayer = playerStats.find(p => p.id === match.white);
                const blackPlayer = playerStats.find(p => p.id === match.black);

                whitePlayer.points += getPointsFromResult(match.result, "white");
                blackPlayer.points += getPointsFromResult(match.result, "black");

                whitePlayer.opponents.push(match.black);
                blackPlayer.opponents.push(match.white);

                const currentRoundPointsWhite = getPointsFromResult(match.result, "white");
                const currentRoundPointsBlack = getPointsFromResult(match.result, "black");

                for (let r = match.round - 1; r < 5; r++) {
                    playerStats.find(p => p.id === match.white).progressiveScores[r] += currentRoundPointsWhite;
                    playerStats.find(p => p.id === match.black).progressiveScores[r] += currentRoundPointsBlack;
                }
            });

            playerStats.forEach(player => {
                let buchholzScores = [];
                let sonnebornBergerScore = 0;

                player.opponents.forEach(opponentId => {
                    const opponent = playerStats.find(p => p.id === opponentId);
                    if (opponent) {
                        buchholzScores.push(opponent.points);

                        const playerMatch = matches.find(m =>
                            (m.white === player.id && m.black === opponentId) ||
                            (m.black === player.id && m.white === opponentId)
                        );

                        if (playerMatch) {
                            const relativeResult = getRelativeResult(player.id, playerMatch);
                            if (relativeResult === "win") {
                                sonnebornBergerScore += opponent.points;
                            } else if (relativeResult === "draw") {
                                sonnebornBergerScore += 0.5 * opponent.points;
                            }
                        }
                    }
                });

                if (buchholzScores.length > 0) {
                    const minOpponentScore = Math.min(...buchholzScores);
                    const sumWithoutMin = buchholzScores
                                        .filter(score => score !== minOpponentScore)
                                        .reduce((sum, score) => sum + score, 0);
                    player.tb1 = sumWithoutMin;
                } else {
                    player.tb1 = 0;
                }

                player.tb2 = sonnebornBergerScore;
                player.tb3 = player.progressiveScores.reduce((sum, score) => sum + score, 0);
            });

            return playerStats;
        }

        // --- DOM Elements ---
        const standingsView = document.getElementById("standings-view");
        const playerDetailView = document.getElementById("player-detail-view");
        const standingsContainer = document.getElementById("standings-container");
        const playerDetailName = document.getElementById("player-detail-name");
        const playerMatchesContainer = document.getElementById("player-matches-container");
        const backToStandingsBtn = document.getElementById("back-to-standings-btn");

        // --- Render Klasemen ---
        function renderStandings() {
            const calculatedPlayerStats = calculateAllMetrics();

            const sortedPlayers = calculatedPlayerStats.sort((a, b) => {
                if (b.points !== a.points) return b.points - a.points;
                if (b.tb1 !== a.tb1) return b.tb1 - a.tb1;
                if (b.tb2 !== a.tb2) return b.tb2 - a.tb2;
                return b.tb3 - a.tb3;
            });

            let tableHTML = `
                <table class="standings-table">
                    <thead>
                        <tr>
                            <th>Peringkat</th>
                            <th>Pemain</th>
                            <th>Negara</th>
                            <th>Poin</th>
                            <th>TB1 (BC1)</th>
                            <th>TB2 (SB)</th>
                            <th>TB3 (Prog)</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedPlayers.forEach((player, index) => {
                tableHTML += `
                    <tr data-player-id="${player.id}">
                        <td class="rank" data-label="Peringkat:">${index + 1}</td>
                        <td class="player-name" data-label="Pemain:">${player.name}</td>
                        <td class="country" data-label="Negara:">${player.country}</td>
                        <td class="points" data-label="Poin:">${player.points.toFixed(1)}</td>
                        <td class="tb-value" data-label="TB1:">${player.tb1.toFixed(1)}</td>
                        <td class="tb-value" data-label="TB2:">${player.tb2.toFixed(1)}</td>
                        <td class="tb-value" data-label="TB3:">${player.tb3.toFixed(1)}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;
            standingsContainer.innerHTML = tableHTML;

            standingsContainer.querySelectorAll("tbody tr").forEach(row => {
                row.addEventListener("click", function() {
                    const playerId = this.dataset.playerId;
                    const player = players.find(p => p.id === playerId);
                    if (player) {
                        displayPlayerDetails(player);
                    }
                });
            });
        }

        // --- Tampilkan Detail Pemain dan Pairing ---
        function displayPlayerDetails(selectedPlayer) {
            standingsView.style.display = "none";
            playerDetailView.style.display = "block";

            const playerWithMetrics = calculateAllMetrics().find(p => p.id === selectedPlayer.id);

            playerDetailName.innerHTML = `<i class="fas fa-user-circle"></i> ${selectedPlayer.name} (${selectedPlayer.country}) <span class="player-score">Poin: ${playerWithMetrics.points.toFixed(1)}</span>`;
            playerMatchesContainer.innerHTML = "";

            const playerMatches = matches
                .filter(m => m.white === selectedPlayer.id || m.black === selectedPlayer.id)
                .sort((a, b) => a.round - b.round);

            playerMatches.forEach(match => {
                let whitePlayerName = getPlayerById(match.white).name;
                let blackPlayerName = getPlayerById(match.black).name;
                const resultInfo = getResultTextAndClass(getRelativeResult(selectedPlayer.id, match));

                const matchDiv = document.createElement("div");
                matchDiv.classList.add("match-item");
                matchDiv.innerHTML = `
                    <div class="match-round"><i class="fas fa-chess-board"></i> Babak ${match.round}</div>
                    <div class="match-players">
                        <strong>${whitePlayerName}</strong> <span class="color-label">(Putih)</span> vs
                        <strong>${blackPlayerName}</strong> <span class="color-label">(Hitam)</span>
                    </div>
                    <div class="match-result ${resultInfo.class}">${resultInfo.text}</div>
                `;
                playerMatchesContainer.appendChild(matchDiv);
            });
        }

        // --- Event Listeners untuk Tombol Kembali ---
        backToStandingsBtn.addEventListener("click", function() {
            playerDetailView.style.display = "none";
            standingsView.style.display = "block";
        });

        // --- Inisialisasi Saat Dokumen Dimuat ---
        document.addEventListener("DOMContentLoaded", renderStandings);
    </script>
</body>
</html>